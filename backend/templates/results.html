{% extends "base.html" %}

{% block content %}
<div class="min-h-screen bg-[#f4f1ea] py-20 relative">

    <!-- Floating Cart Button -->
    <div id="cart-btn" class="fixed bottom-8 left-8 z-50 bg-[color:var(--color-black)] text-white p-4 rounded-full shadow-2xl cursor-pointer hover:scale-110 transition-transform" onclick="toggleCart()">
        <div class="relative">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 0 0-3 3h15.75m-12.75-3h11.218c1.121-2.3 2.1-4.684 2.924-7.138a60.114 60.114 0 0 0-16.536-1.84M7.5 14.25 5.106 5.272M6 20.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Zm12.75 0a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z" />
            </svg>
            <span id="cart-count" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold w-6 h-6 flex items-center justify-center rounded-full">0</span>
        </div>
    </div>

    <!-- Cart Sidebar (Hidden by default) -->
    <div id="cart-overlay" onclick="toggleCart()" class="fixed inset-0 bg-black/50 z-40 hidden backdrop-blur-sm transition-opacity"></div>
    <div id="cart-sidebar" class="fixed inset-y-0 left-0 w-80 bg-white shadow-2xl transform -translate-x-full transition-transform duration-300 z-50 p-6 overflow-y-auto">
        <div class="flex justify-between items-center mb-8 border-b pb-4">
            <h3 class="font-serif text-2xl text-[color:var(--color-espresso)]">×”×¡×œ ×©×œ×™</h3>
             <button onclick="toggleCart()" class="p-2 text-gray-400 hover:text-red-500 transition-colors rounded-full hover:bg-gray-100">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
        <div id="cart-items" class="space-y-4">
            <!-- Cart items will be injected here -->
            <p class="text-gray-400 text-center">×”×¡×œ ×¨×™×§</p>
        </div>
        <div class="mt-8 pt-4 border-t">
            <button onclick="clearCart()" class="w-full py-3 bg-red-50 text-red-500 hover:bg-red-100 transition-colors text-sm font-bold uppercase tracking-widest mb-4">
                ×¨×•×§×Ÿ ×¡×œ
            </button>
            <button onclick="saveEvent()" class="w-full py-4 bg-[color:var(--color-black)] text-white hover:bg-gray-800 transition-colors text-sm font-bold uppercase tracking-widest">
                ×©××•×¨ ××™×¨×•×¢
            </button>
        </div>
    </div>

    <div class="container px-4 md:px-8 mt-0">
        <!-- Header -->
        <div class="text-center mb-8 fade-in-up">
            <h2 class="font-serif text-3xl md:text-4xl mb-2 text-[color:var(--color-black)]">×”×‘×—×™×¨×•×ª ×©×œ×š</h2>
            <p class="font-sans text-gray-500 text-xs tracking-widest uppercase">×‘×—×¨ ××ª ×”×¡×¤×§×™× ×”××•×©×œ××™× ×œ××™×¨×•×¢ ×©×œ×š</p>
        </div>

        <!-- Advanced Filters - Professional Edition -->
        <div class="bg-white rounded-xl shadow-lg p-8 mb-8 fade-in-up border border-gray-100">
            <!-- Filter Header -->
            <div class="flex justify-between items-center mb-6 pb-4 border-b border-gray-100">
                <div>
                    <h3 class="font-serif text-xl text-[color:var(--color-espresso)]">×¡×™× ×•×Ÿ ××ª×§×“×</h3>
                    <p class="text-xs text-gray-400 mt-1">××¦× ××ª ×”×¡×¤×§×™× ×”××•×©×œ××™× ×‘×§×œ×•×ª</p>
                </div>
                <div class="flex items-center gap-3">
                    <button onclick="toggleCompareMode()" id="compareBtn"
                            class="px-4 py-2 border border-gray-300 rounded-lg text-xs font-bold uppercase tracking-wide hover:bg-gray-50 transition-colors flex items-center gap-2">
                        <span class="hidden" id="compareIcon">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 inline-block">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v17.25m0 0c-1.472 0-2.882.265-4.185.75M12 20.25c1.472 0 2.882.265 4.185.75M18.75 4.97A5.96 5.96 0 0 0 12 4.97c-3.926 0-7.429 2.59-9.231 6.315a6.002 6.002 0 0 0 0 4.156C4.57 18.067 8.074 19.657 12 19.657c3.926 0 7.429-1.59 9.231-5.315a6.002 6.002 0 0 0 0-4.156A11.97 11.97 0 0 0 18.75 4.97Z" />
                            </svg>
                        </span> ×”×©×•×•××”
                    </button>
                    <button onclick="resetFilters()"
                            class="px-4 py-2 bg-red-50 text-red-600 rounded-lg text-xs font-bold uppercase tracking-wide hover:bg-red-100 transition-colors">
                        × ×§×” ×”×›×œ
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- Smart Search with Autocomplete -->
                <div class="relative">
                    <label class="block text-xs font-bold text-gray-700 mb-2 uppercase tracking-wide flex items-center gap-1">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                            <path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" />
                        </svg>
                        ×—×™×¤×•×© ×—×›×
                    </label>
                    <input type="text" id="searchInput" placeholder="×”×§×œ×“ ×œ×—×™×¤×•×©..."
                           class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-[color:var(--color-espresso)] focus:ring-2 focus:ring-[color:var(--color-caramel)]/20 outline-none text-sm transition-all"
                           oninput="handleSmartSearch(this.value)" autocomplete="off">
                    <div id="searchSuggestions" class="absolute top-full left-0 right-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg max-h-60 overflow-y-auto z-50 hidden"></div>
                </div>

                <!-- Multi-Select Category Filter -->
                <div>
                    <label class="block text-xs font-bold text-gray-700 mb-2 uppercase tracking-wide flex items-center gap-1">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12.75V12A2.25 2.25 0 0 1 4.5 9.75h15A2.25 2.25 0 0 1 21.75 12v.75m-8.69-6.41-2.12-2.12a1.5 1.5 0 0 0-1.061-.44H4.5A2.25 2.25 0 0 0 2.25 6v12a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9a2.25 2.25 0 0 0-2.25-2.25h-5.379a1.5 1.5 0 0 1-1.06-.44Z" />
                        </svg>
                        ×§×˜×’×•×¨×™×•×ª
                    </label>
                    <div class="relative">
                        <button onclick="toggleCategoryDropdown()"
                                class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-sm text-right hover:border-[color:var(--color-espresso)] transition-all flex justify-between items-center">
                            <span id="categorySelectedText" class="text-gray-500">×‘×—×¨ ×§×˜×’×•×¨×™×•×ª...</span>
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        <div id="categoryDropdown" class="absolute top-full left-0 right-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg p-3 z-50 hidden max-h-60 overflow-y-auto">
                            <!-- Categories will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- City Multi-Select -->
                <div>
                    <label class="block text-xs font-bold text-gray-700 mb-2 uppercase tracking-wide flex items-center gap-1">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                            <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z" />
                        </svg>
                         ×¢×¨×™×
                    </label>
                    <div class="relative">
                        <button onclick="toggleCityDropdown()"
                                class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg text-sm text-right hover:border-[color:var(--color-espresso)] transition-all flex justify-between items-center">
                            <span id="citySelectedText" class="text-gray-500">×‘×—×¨ ×¢×¨×™×...</span>
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                            </svg>
                        </button>
                        <div id="cityDropdown" class="absolute top-full left-0 right-0 mt-1 bg-white border border-gray-200 rounded-lg shadow-lg p-3 z-50 hidden max-h-60 overflow-y-auto">
                            <!-- Cities will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Price Range with Visual Feedback -->
                <div>
                    <label class="block text-xs font-bold text-gray-700 mb-2 uppercase tracking-wide flex items-center gap-1">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v12m-3-2.818.879.659c1.171.879 3.07.879 4.242 0 1.172-.879 1.172-2.303 0-3.182C13.536 12.219 12.768 12 12 12c-.725 0-1.45-.22-2.003-.659-1.106-.879-1.106-2.303 0-3.182s2.9-.879 4.006 0l.415.33M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                        </svg>
                        ×˜×•×•×— ××—×™×¨×™×
                        <span id="priceRangeDisplay" class="font-normal text-[color:var(--color-caramel)] mr-2"></span>
                    </label>
                    <div class="relative pt-1">
                        <input type="range" id="priceRange" min="0" max="20000" value="20000" step="500"
                               class="w-full h-2 bg-gradient-to-r from-green-200 via-yellow-200 to-red-200 rounded-lg appearance-none cursor-pointer accent-[color:var(--color-espresso)]"
                               oninput="updatePriceDisplay(); applyFilters()">
                        <div class="flex justify-between text-xs text-gray-400 mt-1">
                            <span>0 â‚ª</span>
                            <span>20,000 â‚ª</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Second Row - Advanced Filters -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6 pt-6 border-t border-gray-100">
                <!-- Rating Filter -->
                <div>
                    <label class="block text-xs font-bold text-gray-700 mb-2 uppercase tracking-wide flex items-center gap-1">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M11.48 3.499a.562.562 0 0 1 1.04 0l2.125 5.111a.563.563 0 0 0 .475.345l5.518.442c.499.04.701.663.321.988l-4.204 3.602a.563.563 0 0 0-.182.557l1.285 5.385a.562.562 0 0 1-.84.61l-4.725-2.885a.563.563 0 0 0-.586 0L6.982 20.54a.562.562 0 0 1-.84-.61l1.285-5.386a.562.562 0 0 0-.182-.557l-4.204-3.602a.563.563 0 0 1 .321-.988l5.518-.442a.563.563 0 0 0 .475-.345L11.48 3.5Z" />
                        </svg>
                        ×“×™×¨×•×’ ××™× ×™××œ×™
                    </label>
                    <div class="flex gap-2">
                        <button onclick="setMinRating(0)" class="rating-btn px-3 py-2 border-2 border-gray-200 rounded-lg text-sm hover:border-[color:var(--color-caramel)] transition-all" data-rating="0">
                            ×”×›×œ
                        </button>
                        <button onclick="setMinRating(3)" class="rating-btn px-3 py-2 border-2 border-gray-200 rounded-lg text-sm hover:border-[color:var(--color-caramel)] transition-all" data-rating="3">
                            3+
                        </button>
                        <button onclick="setMinRating(4)" class="rating-btn px-3 py-2 border-2 border-gray-200 rounded-lg text-sm hover:border-[color:var(--color-caramel)] transition-all" data-rating="4">
                            4+
                        </button>
                        <button onclick="setMinRating(4.5)" class="rating-btn px-3 py-2 border-2 border-gray-200 rounded-lg text-sm hover:border-[color:var(--color-caramel)] transition-all" data-rating="4.5">
                            4.5+
                        </button>
                    </div>
                </div>

                <!-- Sort Options -->
                <div>
                    <label class="block text-xs font-bold text-gray-700 mb-2 uppercase tracking-wide flex items-center gap-1">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3 7.5L7.5 3m0 0L12 7.5M7.5 3v13.5m13.5 0L16.5 21m0 0L12 16.5m4.5 4.5V7.5" />
                        </svg>
                        ××™×•×Ÿ ×ª×•×¦××•×ª
                    </label>
                    <select id="sortBy" class="w-full px-4 py-3 border-2 border-gray-200 rounded-lg focus:border-[color:var(--color-espresso)] outline-none text-sm transition-all" onchange="applyFilters()">
                        <option value="recommended">××•××œ×¥</option>
                        <option value="name-asc">×©× (×-×ª)</option>
                        <option value="name-desc">×©× (×ª-×)</option>
                        <option value="price-asc">××—×™×¨ (× ××•×š ×œ×’×‘×•×”)</option>
                        <option value="price-desc">××—×™×¨ (×’×‘×•×” ×œ× ××•×š)</option>
                        <option value="rating-desc">×“×™×¨×•×’ (×’×‘×•×” ×œ× ××•×š)</option>
                        <option value="popular">×”×›×™ ×¤×•×¤×•×œ×¨×™</option>
                    </select>
                </div>

                <!-- Results Counter -->
                <div>
                    <label class="block text-xs font-bold text-gray-700 mb-2 uppercase tracking-wide flex items-center gap-1">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z" />
                        </svg>
                        ×ª×•×¦××•×ª
                    </label>
                    <div class="px-4 py-3 bg-gradient-to-r from-[color:var(--color-espresso)] to-[color:var(--color-coffee)] text-white rounded-lg text-center">
                        <div class="text-2xl font-bold" id="resultsCount">0</div>
                        <div class="text-xs opacity-90">×¡×¤×§×™× × ××¦××•</div>
                    </div>
                </div>
            </div>

            <!-- Active Filters Tags -->
            <div id="activeFilters" class="mt-6 flex gap-2 flex-wrap hidden">
                <!-- Filter tags will appear here -->
            </div>
        </div>

        <!-- Premium Category Navigation -->
        <div class="sticky top-[54px] z-40 bg-gradient-to-b from-[#f4f1ea] to-[#f4f1ea]/95 backdrop-blur-md py-2 mb-12 border-b border-gray-200/50 shadow-sm -mx-4 md:-mx-8 px-4 md:px-8">
            <div class="flex justify-center items-center gap-2 flex-wrap px-4 max-w-full overflow-x-auto pb-1">
                <!-- All Categories Button -->
                <button onclick="filterByCategory('all')"
                       class="category-filter-btn px-6 py-2 bg-gradient-to-r from-[color:var(--color-espresso)] to-[color:var(--color-coffee)] border-2 border-[color:var(--color-espresso)] rounded-full text-white font-bold text-xs uppercase tracking-wide whitespace-nowrap transition-all hover:shadow-lg active"
                       data-category="all">
                    ×”×›×œ
                </button>

                {% for category, items in results.items() %}
                    {% if items %}
                    <button onclick="filterByCategory('{{ category }}')"
                       class="category-filter-btn px-6 py-2 bg-white border-2 border-gray-300 rounded-full text-[color:var(--color-espresso)] font-bold text-xs uppercase tracking-wide whitespace-nowrap transition-all hover:scale-105 hover:shadow-md hover:border-[color:var(--color-caramel)] hover:bg-[#faf7f2] hover:text-[color:var(--color-caramel)]"
                       data-category="{{ category }}">
                        {{ category }}
                    </button>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
        <!-- Results Sections -->
        <div class="space-y-20">
            {% for category, items in results.items() %}
                {% if items %}
                <section id="{{ category }}" class="scroll-mt-24 fade-in-up">
                    <div class="flex items-center mb-10">
                        <h3 class="font-serif text-3xl text-[color:var(--color-black)] ml-6">{{ category }}</h3>
                        <div class="h-px bg-gray-200 flex-grow"></div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-10">
                        {% for item in items %}
                        <div class="group bg-white rounded-xl transition-all duration-500 hover:shadow-2xl border-2 border-gray-100 hover:border-[color:var(--color-caramel)] overflow-hidden relative supplier-card"
                             data-id="{{ item.id }}"
                             data-type="{{ item.type }}"
                             data-name="{{ item.name }}"
                             data-price="{{ item.price }}"
                             data-category="{{ category }}"
                             data-rating="{{ (3.5 + (loop.index % 15) * 0.1) | round(1) }}"
                             data-item='{"name":"{{ item.name }}", "price":{{ item.price }}, "description":"{{ item.description }}", "category":"{{ category }}"}'>

                            <!-- Compare Checkbox (hidden by default) -->
                            <div class="compare-checkbox hidden absolute top-4 left-4 z-10">
                                <input type="checkbox"
                                       class="w-6 h-6 rounded border-2 border-white shadow-lg cursor-pointer accent-[color:var(--color-espresso)]"
                                       onchange="toggleCompareItem(this, '{{ item.id }}')">
                            </div>

                            <!-- Favorite Heart Icon -->
                            <button class="absolute top-4 right-4 z-10 w-10 h-10 bg-white/90 backdrop-blur-sm rounded-full flex items-center justify-center shadow-md hover:scale-110 transition-transform"
                                    onclick="toggleFavorite('{{ item.id }}', this)">
                                <svg class="w-5 h-5 text-gray-400 hover:text-red-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                                </svg>
                            </button>

                            <div class="relative h-72 overflow-hidden">
                                <img src="{{ item.image }}" alt="{{ item.name }}" class="w-full h-full object-cover transition-transform duration-1000 group-hover:scale-110">

                                <!-- Category Badge -->
                                <div class="absolute bottom-4 right-4 bg-gradient-to-r from-[color:var(--color-espresso)] to-[color:var(--color-coffee)] backdrop-blur-sm px-4 py-2 rounded-full text-[10px] font-bold uppercase tracking-widest text-white shadow-lg">
                                    {{ item.category }}
                                </div>

                                <!-- Rating Badge -->
                                <div class="absolute top-4 left-4 bg-white/95 backdrop-blur-sm px-3 py-1.5 rounded-full text-xs font-bold flex items-center gap-1 shadow-md">
                                    <span class="text-yellow-500">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-3 h-3">
                                            <path fill-rule="evenodd" d="M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.007 5.404.433c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.433 2.082-5.006z" clip-rule="evenodd" />
                                        </svg>
                                    </span>
                                    <span class="text-[color:var(--color-espresso)]">{{ (3.5 + (loop.index % 15) * 0.1) | round(1) }}</span>
                                </div>
                            </div>

                            <div class="p-6">
                                <h4 class="font-serif text-2xl mb-2 text-[color:var(--color-espresso)] group-hover:text-[color:var(--color-caramel)] transition-colors">
                                    {{ item.name }}
                                </h4>
                                <p class="text-gray-500 mb-4 text-sm font-sans leading-relaxed h-12 overflow-hidden">
                                    {{ item.description }}
                                </p>

                                <!-- Quick Info Tags -->
                                <div class="flex flex-wrap gap-2 mb-4">
                                    <span class="px-3 py-1 bg-gray-100 rounded-full text-xs text-gray-600 flex items-center gap-1">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-3 h-3">
                                            <path fill-rule="evenodd" d="M1.5 4.5a3 3 0 0 1 3-3h1.372c.86 0 1.61.586 1.819 1.42l1.105 4.423a1.875 1.875 0 0 1-.694 1.955l-1.293.97c-.135.101-.164.249-.126.352a11.285 11.285 0 0 0 6.697 6.697c.103.038.25.009.352-.126l.97-1.293a1.875 1.875 0 0 1 1.955-.694l4.423 1.105c.834.209 1.42.959 1.42 1.82V19.5a3 3 0 0 1-3 3h-2.25C8.552 22.5 1.5 15.448 1.5 6.75V4.5Z" clip-rule="evenodd" />
                                        </svg>
                                        ×–××™×Ÿ
                                    </span>
                                    <span class="px-3 py-1 bg-green-50 rounded-full text-xs text-green-600 flex items-center gap-1">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-3 h-3">
                                            <path fill-rule="evenodd" d="M19.916 4.626a.75.75 0 0 1 .207 1.012l-7.5 13a.75.75 0 0 1-1.297.007l-2.6-4.5a.75.75 0 0 1 1.297-.75l1.947 3.37 6.934-12.016a.75.75 0 0 1 1.012-.207Z" clip-rule="evenodd" />
                                        </svg>
                                        ××•××œ×¥
                                    </span>
                                </div>

                                <div class="border-t border-gray-100 pt-4 space-y-3">
                                    <!-- Price -->
                                    <div class="flex justify-between items-center">
                                        <span class="text-gray-500 text-sm">××—×™×¨ ×-</span>
                                        <span class="text-[color:var(--color-espresso)] font-bold text-2xl">{{ item.price }} â‚ª</span>
                                    </div>

                                    <!-- Action Buttons -->
                                    <div class="grid grid-cols-2 gap-2">
                                        <button onclick="viewDetails('{{ item.id }}', '{{ item.type }}')"
                                                class="py-2.5 border-2 border-gray-200 text-gray-700 rounded-lg hover:border-[color:var(--color-espresso)] hover:bg-gray-50 transition-all text-xs font-bold uppercase tracking-wide">
                                            ×¤×¨×˜×™×
                                        </button>
                                        <button data-id="{{ item.id }}"
                                                data-type="{{ item.type }}"
                                                data-name="{{ item.name }}"
                                                data-price="{{ item.price }}"
                                                onclick="addToCart(this.dataset.id, this.dataset.type, this.dataset.name, this.dataset.price, this)"
                                                class="add-to-cart-btn py-2.5 bg-gradient-to-r from-[color:var(--color-espresso)] to-[color:var(--color-coffee)] text-white rounded-lg hover:shadow-lg hover:scale-105 transition-all text-xs font-bold uppercase tracking-wide">
                                            ×”×•×¡×£ ×œ×¡×œ
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </section>
                {% endif %}
            {% endfor %}
        </div>
    </div>
</div>

<script>
    // ============ GLOBAL STATE ============
    let cart = [];
    let compareMode = false;
    let compareItems = [];
    let selectedCategories = [];
    let selectedCities = [];
    let minRating = 0;
    let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
    let activeQuickCategory = 'all';

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
        console.log('ğŸ”µ Page loaded, initializing...');

        fetchCart();

        // Initialize filters
        updatePriceDisplay();
        updateResultsCount();

        // Initialize dropdowns with data
        initializeCategoryDropdown();
        initializeCityDropdown();

        // Load favorites
        favorites.forEach(favId => {
            const card = document.querySelector(`.supplier-card[data-id="${favId}"]`);
            if (card) {
                const heart = card.querySelector('svg');
                if (heart) {
                    heart.classList.remove('text-gray-400');
                    heart.classList.add('text-red-500');
                }
            }
        });

        // Close dropdowns when clicking outside
        document.addEventListener('click', function(e) {
            if (!e.target.closest('#categoryDropdown') && !e.target.closest('[onclick*="toggleCategoryDropdown"]')) {
                document.getElementById('categoryDropdown')?.classList.add('hidden');
            }
            if (!e.target.closest('#cityDropdown') && !e.target.closest('[onclick*="toggleCityDropdown"]')) {
                document.getElementById('cityDropdown')?.classList.add('hidden');
            }
            if (!e.target.closest('#searchSuggestions') && !e.target.closest('#searchInput')) {
                document.getElementById('searchSuggestions')?.classList.add('hidden');
            }
        });

        console.log('ğŸ”µ Initialization complete');
    });

    // ============ INITIALIZE DROPDOWNS ============
    function initializeCategoryDropdown() {
        const dropdown = document.getElementById('categoryDropdown');
        if (!dropdown) return;

        const categories = new Set();
        document.querySelectorAll('.supplier-card').forEach(card => {
            if (card.dataset.category) {
                categories.add(card.dataset.category);
            }
        });

        dropdown.innerHTML = Array.from(categories).sort().map(cat => `
            <label class="flex items-center gap-2 p-2 hover:bg-gray-50 rounded cursor-pointer">
                <input type="checkbox" value="${cat}" onchange="toggleCategory('${cat}')"
                       class="w-4 h-4 rounded border-gray-300 accent-[color:var(--color-espresso)]">
                <span class="text-sm">${cat}</span>
            </label>
        `).join('');

        console.log('ğŸ”µ Category dropdown initialized with', categories.size, 'categories');
    }

    function initializeCityDropdown() {
        const dropdown = document.getElementById('cityDropdown');
        if (!dropdown) return;

        const cities = new Set();
        document.querySelectorAll('.supplier-card[data-item]').forEach(card => {
            try {
                const item = JSON.parse(card.getAttribute('data-item'));
                const desc = item.description || '';
                // Try to extract city from description
                const match = desc.match(/([×-×ª\s]+),/) || desc.match(/^([×-×ª\s]+)/);
                if (match) {
                    const city = match[1].trim();
                    if (city.length > 2 && city.length < 20) {
                        cities.add(city);
                    }
                }
            } catch(e) {}
        });

        dropdown.innerHTML = Array.from(cities).sort().map(city => `
            <label class="flex items-center gap-2 p-2 hover:bg-gray-50 rounded cursor-pointer">
                <input type="checkbox" value="${city}" onchange="toggleCity('${city}')"
                       class="w-4 h-4 rounded border-gray-300 accent-[color:var(--color-espresso)]">
                <span class="text-sm">${city}</span>
            </label>
        `).join('');

        console.log('ğŸ”µ City dropdown initialized with', cities.size, 'cities');
    }

    // ============ PRICE DISPLAY ============
    function updatePriceDisplay() {
        const priceRange = document.getElementById('priceRange');
        const display = document.getElementById('priceRangeDisplay');
        display.textContent = `×¢×“ ${parseInt(priceRange.value).toLocaleString()} â‚ª`;
    }

    function applyFilters() {
        const searchTerm = document.getElementById('searchInput').value.toLowerCase();
        const maxPrice = parseInt(document.getElementById('priceRange').value);
        const sortBy = document.getElementById('sortBy').value;

        console.log('ğŸ”µ Applying filters:', {
            search: searchTerm,
            categories: selectedCategories,
            cities: selectedCities,
            maxPrice: maxPrice,
            minRating: minRating,
            sortBy: sortBy
        });

        // Get all supplier cards
        const allCards = Array.from(document.querySelectorAll('.supplier-card'));
        let visibleCount = 0;

        allCards.forEach(card => {
            let shouldShow = true;

            // Search filter
            if (searchTerm) {
                const name = card.dataset.name.toLowerCase();
                const category = card.dataset.category.toLowerCase();
                if (!name.includes(searchTerm) && !category.includes(searchTerm)) {
                    shouldShow = false;
                }
            }

            // Category filter
            if (selectedCategories.length > 0) {
                if (!selectedCategories.includes(card.dataset.category)) {
                    shouldShow = false;
                }
            }

            // City filter
            if (selectedCities.length > 0) {
                try {
                    const item = JSON.parse(card.getAttribute('data-item'));
                    const desc = item.description || '';
                    const hasCity = selectedCities.some(city => desc.includes(city));
                    if (!hasCity) {
                        shouldShow = false;
                    }
                } catch(e) {}
            }

            // Price filter
            const price = parseInt(card.dataset.price);
            if (price > maxPrice) {
                shouldShow = false;
            }

            // Rating filter
            const rating = parseFloat(card.dataset.rating);
            if (rating < minRating) {
                shouldShow = false;
            }

            // Show or hide card
            if (shouldShow) {
                card.classList.remove('hidden');
                card.style.display = 'block';
                visibleCount++;
            } else {
                card.classList.add('hidden');
                card.style.display = 'none';
            }
        });

        // Sort visible cards
        const visibleCards = allCards.filter(card => !card.classList.contains('hidden'));
        visibleCards.sort((a, b) => {
            switch(sortBy) {
                case 'name-asc':
                    return a.dataset.name.localeCompare(b.dataset.name, 'he');
                case 'name-desc':
                    return b.dataset.name.localeCompare(a.dataset.name, 'he');
                case 'price-asc':
                    return parseInt(a.dataset.price) - parseInt(b.dataset.price);
                case 'price-desc':
                    return parseInt(b.dataset.price) - parseInt(a.dataset.price);
                case 'rating-desc':
                    return parseFloat(b.dataset.rating) - parseFloat(a.dataset.rating);
                default:
                    return 0;
            }
        });

        // Reorder visible cards
        visibleCards.forEach((card, index) => {
            card.style.order = index;
        });

        // Update results counter
        if (document.getElementById('resultsCount')) {
            document.getElementById('resultsCount').textContent = visibleCount;
        }

        // Hide empty sections
        document.querySelectorAll('section[id]').forEach(section => {
            const visibleCards = section.querySelectorAll('.supplier-card:not(.hidden)');
            if (visibleCards.length === 0) {
                section.style.display = 'none';
            } else {
                section.style.display = 'block';
            }
        });

        console.log('ğŸ”µ Visible cards:', visibleCount);
    }

    function updateActiveFiltersDisplay(search, city, price) {
        const container = document.getElementById('activeFilters');
        let html = '';

        if (search) {
            html += `<span class="bg-[color:var(--color-black)] text-white px-3 py-1 rounded-full text-xs">×—×™×¤×•×©: ${search}</span>`;
        }
        if (city) {
            html += `<span class="bg-[color:var(--color-black)] text-white px-3 py-1 rounded-full text-xs">×¢×™×¨: ${city}</span>`;
        }
        if (price < 10000) {
            html += `<span class="bg-[color:var(--color-black)] text-white px-3 py-1 rounded-full text-xs">×¢×“ ${price.toLocaleString()} â‚ª</span>`;
        }

        if (html) {
            container.innerHTML = html;
            container.classList.remove('hidden');
        } else {
            container.classList.add('hidden');
        }
    }

    function updateSectionVisibility() {
        document.querySelectorAll('section[id]').forEach(section => {
            const visibleItems = section.querySelectorAll('.group[style*="display: block"]').length;
            if (visibleItems === 0) {
                section.style.display = 'none';
            } else {
                section.style.display = 'block';
            }
        });
    }

    function showResultsCount(filtered, total) {
        // Remove existing count if any
        const existingCount = document.getElementById('results-count');
        if (existingCount) existingCount.remove();

        // Add count below filters
        const filtersDiv = document.querySelector('.bg-white.rounded-lg.shadow-md');
        const countDiv = document.createElement('div');
        countDiv.id = 'results-count';
        countDiv.className = 'text-center text-sm text-gray-600 mt-4 font-sans';
        countDiv.innerHTML = `××¦×™×’ <strong>${filtered}</strong> ××ª×•×š <strong>${total}</strong> ×ª×•×¦××•×ª`;
        filtersDiv.appendChild(countDiv);
    }

    function toggleCart() {
        const sidebar = document.getElementById('cart-sidebar');
        const overlay = document.getElementById('cart-overlay');
        
        if (sidebar.classList.contains('-translate-x-full')) {
            sidebar.classList.remove('-translate-x-full');
            overlay.classList.remove('hidden');
        } else {
            sidebar.classList.add('-translate-x-full');
            overlay.classList.add('hidden');
        }
    }

    function updateCartUI() {
        console.log('ğŸ”µ Updating cart UI, cart items:', cart);

        const container = document.getElementById('cart-items');
        const countBadge = document.getElementById('cart-count');

        countBadge.innerText = cart.length;

        if (cart.length === 0) {
            container.innerHTML = '<p class="text-gray-400 text-center">×”×¡×œ ×¨×™×§</p>';
            return;
        }

        let html = '';
        let total = 0;
        cart.forEach(item => {
            total += parseInt(item.price);
            html += `
                <div class="flex justify-between items-center bg-gray-50 p-3 rounded">
                    <div>
                        <p class="font-bold text-sm">${item.name}</p>
                        <p class="text-xs text-gray-500">${item.price} â‚ª</p>
                    </div>
                </div>
            `;
        });

        html += `
            <div class="mt-4 pt-4 border-t border-gray-200 flex justify-between font-bold">
                <span>×¡×”"×›:</span>
                <span>${total} â‚ª</span>
            </div>
        `;

        console.log('ğŸ”µ Cart HTML generated, total:', total);
        container.innerHTML = html;
    }

    function addToCart(id, type, name, price, btnElement) {
        console.log('ğŸ”µ Adding to cart:', {id, type, name, price});

        fetch('/api/cart/add', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ id, type, name, price }),
        })
        .then(response => response.json())
        .then(data => {
            console.log('ğŸ”µ Server response:', data);

            if (data.success) {
                // Fetch fresh cart
                fetchCart();

                // Show visual feedback on button
                if (btnElement) {
                    const originalText = btnElement.innerText;
                    btnElement.innerText = "× ×•×¡×£ âœ“";
                    btnElement.classList.add('bg-green-600', 'text-white', 'border-green-600');
                    setTimeout(() => {
                        btnElement.innerText = originalText;
                        btnElement.classList.remove('bg-green-600', 'text-white', 'border-green-600');
                    }, 2000);
                }
            } else {
                console.warn('âš ï¸ Item not added:', data.message);
                alert(data.message);
            }
        })
        .catch(error => {
            console.error('âŒ Error adding to cart:', error);
            alert('×©×’×™××” ×‘×”×•×¡×¤×” ×œ×¡×œ');
        });
    }

    function fetchCart() {
        console.log('ğŸ”µ Fetching cart from server...');
        fetch('/api/cart')
        .then(res => res.json())
        .then(data => {
            console.log('ğŸ”µ Cart received:', data);
            cart = data.cart || [];
            console.log('ğŸ”µ Cart items:', cart);
            updateCartUI();
        })
        .catch(error => {
            console.error('âŒ Error fetching cart:', error);
        });
    }

    function clearCart() {
        fetch('/api/cart/clear', { method: 'POST' })
        .then(() => {
            cart = [];
            updateCartUI();
        });
    }

    async function saveEvent() {
        console.log('ğŸ”µ saveEvent called, cart:', cart);

        // Check if user is logged in
        const authResponse = await fetch('/api/current_user');
        const authData = await authResponse.json();
        console.log('ğŸ”µ Auth data:', authData);

        if (!authData.authenticated) {
            alert('×× × ×”×ª×—×‘×¨ ×ª×—×™×œ×” ×›×“×™ ×œ×©××•×¨ ××™×¨×•×¢');
            window.location.href = '/login';
            return;
        }

        // Check if cart is not empty
        if (cart.length === 0) {
            alert('×× × ×‘×—×¨ ×œ×¤×—×•×ª ×¡×¤×§ ××—×“');
            return;
        }

        console.log('ğŸ”µ Sending cart to server:', cart);

        try {
            // Save the event with all cart items
            const response = await fetch('/api/save_cart_to_event', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    cart_items: cart
                })
            });

            const data = await response.json();
            console.log('ğŸ”µ Server response:', data);

            if (data.success) {
                // Clear cart after successful save
                await fetch('/api/cart/clear', { method: 'POST' });
                cart = [];
                updateCartUI();

                alert(data.message);
                window.location.href = data.redirect || '/dashboard';
            } else {
                alert(data.message);
            }
        } catch (error) {
            console.error('âŒ Error saving event:', error);
            alert('×©×’×™××” ×‘×©××™×¨×ª ×”××™×¨×•×¢');
        }
    }

    // Active category management
    function updateActiveCategory(clickedBtn) {
        // Remove active state from all buttons
        document.querySelectorAll('.category-btn').forEach(btn => {
            btn.classList.remove('active-category');
        });
        // Add active state to clicked button
        clickedBtn.classList.add('active-category');
    }

    // ============ ADVANCED FEATURES ============

    // Quick Category Filter (Top Buttons)
    function filterByCategory(category) {
        console.log('ğŸ”µ Quick filter by category:', category);
        activeQuickCategory = category;

        // Update button styles
        document.querySelectorAll('.category-filter-btn').forEach(btn => {
            if (btn.dataset.category === category) {
                btn.classList.remove('bg-white', 'border-gray-300', 'text-[color:var(--color-espresso)]');
                btn.classList.add('bg-gradient-to-r', 'from-[color:var(--color-espresso)]', 'to-[color:var(--color-coffee)]', 'border-[color:var(--color-espresso)]', 'text-white');
            } else {
                btn.classList.remove('bg-gradient-to-r', 'from-[color:var(--color-espresso)]', 'to-[color:var(--color-coffee)]', 'border-[color:var(--color-espresso)]', 'text-white');
                btn.classList.add('bg-white', 'border-gray-300', 'text-[color:var(--color-espresso)]');
            }
        });

        // Update internal state and sync dropdown
        if (category !== 'all') {
            selectedCategories = [category];
        } else {
            selectedCategories = [];
        }

        syncCategoryDropdown();
        updateCategoryText();

        // Apply filters
        applyFilters();

        // Scroll to first visible card
        if (category !== 'all') {
            setTimeout(() => {
                const resultsSection = document.querySelector('.bg-white.rounded-xl.shadow-lg');
                if (resultsSection) {
                    resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }, 100);
        }
    }

    // Sync dropdown checkboxes with selectedCategories state
    function syncCategoryDropdown() {
        const checkboxes = document.querySelectorAll('#categoryDropdown input[type="checkbox"]');
        checkboxes.forEach(cb => {
            cb.checked = selectedCategories.includes(cb.value);
        });
    }

    // Smart Search with Autocomplete
    function handleSmartSearch(query) {
        const suggestions = document.getElementById('searchSuggestions');

        if (!query || query.length < 2) {
            suggestions.classList.add('hidden');
            applyFilters();
            return;
        }

        // Get all items
        const allCards = document.querySelectorAll('.supplier-card');
        const matches = [];

        allCards.forEach(card => {
            const name = card.dataset.name.toLowerCase();
            const category = card.dataset.category.toLowerCase();
            if (name.includes(query.toLowerCase()) || category.includes(query.toLowerCase())) {
                matches.push({
                    name: card.dataset.name,
                    category: card.dataset.category,
                    price: card.dataset.price
                });
            }
        });

        if (matches.length > 0) {
            suggestions.innerHTML = matches.slice(0, 5).map(m => `
                <div class="px-4 py-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-0"
                     onclick="selectSuggestion('${m.name}')">
                    <div class="font-semibold text-sm">${m.name}</div>
                    <div class="text-xs text-gray-500">${m.category} â€¢ ${m.price} â‚ª</div>
                </div>
            `).join('');
            suggestions.classList.remove('hidden');
        } else {
            suggestions.classList.add('hidden');
        }

        applyFilters();
    }

    function selectSuggestion(name) {
        document.getElementById('searchInput').value = name;
        document.getElementById('searchSuggestions').classList.add('hidden');
        applyFilters();
    }

    // Multi-Select Category Filter
    function toggleCategoryDropdown() {
        const dropdown = document.getElementById('categoryDropdown');
        const cityDropdown = document.getElementById('cityDropdown');

        // Close other dropdowns
        cityDropdown?.classList.add('hidden');

        dropdown.classList.toggle('hidden');
    }

    function toggleCategory(category) {
        const index = selectedCategories.indexOf(category);
        if (index > -1) {
            selectedCategories.splice(index, 1);
        } else {
            selectedCategories.push(category);
        }

        // Sync top buttons
        if (selectedCategories.length === 1) {
            // Highlight specific category button if exists
             const btn = document.querySelector(`.category-filter-btn[data-category="${selectedCategories[0]}"]`);
             if (btn) {
                 filterByCategory(selectedCategories[0]);
                 return; // filterByCategory already handles applyFilters
             }
        } else if (selectedCategories.length === 0) {
            // Reset to All
            filterByCategory('all');
            return;
        } else {
            // Multiple selected - uncheck all top buttons (except 'active' logic if we want a 'custom' state)
             document.querySelectorAll('.category-filter-btn').forEach(btn => {
                btn.classList.remove('bg-gradient-to-r', 'from-[color:var(--color-espresso)]', 'to-[color:var(--color-coffee)]', 'border-[color:var(--color-espresso)]', 'text-white');
                btn.classList.add('bg-white', 'border-gray-300', 'text-[color:var(--color-espresso)]');
            });
        }

        updateCategoryText();
        applyFilters();
    }

    function updateCategoryText() {
        const text = document.getElementById('categorySelectedText');
        if (selectedCategories.length === 0) {
            text.textContent = '×‘×—×¨ ×§×˜×’×•×¨×™×•×ª...';
            text.classList.add('text-gray-500');
        } else {
            text.textContent = selectedCategories.join(', ');
            text.classList.remove('text-gray-500');
        }
    }

    // Multi-Select City Filter
    function toggleCityDropdown() {
        const dropdown = document.getElementById('cityDropdown');
        const categoryDropdown = document.getElementById('categoryDropdown');

        // Close other dropdowns
        categoryDropdown?.classList.add('hidden');

        dropdown.classList.toggle('hidden');
    }

    function toggleCity(city) {
        const index = selectedCities.indexOf(city);
        if (index > -1) {
            selectedCities.splice(index, 1);
        } else {
            selectedCities.push(city);
        }
        updateCityText();
        applyFilters();
    }

    function updateCityText() {
        const text = document.getElementById('citySelectedText');
        if (selectedCities.length === 0) {
            text.textContent = '×‘×—×¨ ×¢×¨×™×...';
            text.classList.add('text-gray-500');
        } else {
            text.textContent = selectedCities.join(', ');
            text.classList.remove('text-gray-500');
        }
    }

    // Rating Filter
    function setMinRating(rating) {
        minRating = rating;
        document.querySelectorAll('.rating-btn').forEach(btn => {
            if (parseFloat(btn.dataset.rating) === rating) {
                btn.classList.add('bg-[color:var(--color-espresso)]', 'text-white', 'border-[color:var(--color-espresso)]');
            } else {
                btn.classList.remove('bg-[color:var(--color-espresso)]', 'text-white', 'border-[color:var(--color-espresso)]');
            }
        });
        applyFilters();
    }

    // Compare Mode
    function toggleCompareMode() {
        compareMode = !compareMode;
        const btn = document.getElementById('compareBtn');
        const checkboxes = document.querySelectorAll('.compare-checkbox');

        if (compareMode) {
            btn.classList.add('bg-[color:var(--color-espresso)]', 'text-white');
            checkboxes.forEach(cb => cb.classList.remove('hidden'));
        } else {
            btn.classList.remove('bg-[color:var(--color-espresso)]', 'text-white');
            checkboxes.forEach(cb => cb.classList.add('hidden'));
            compareItems = [];
        }
    }

    function toggleCompareItem(checkbox, itemId) {
        if (checkbox.checked) {
            if (compareItems.length >= 4) {
                alert('× ×™×ª×Ÿ ×œ×”×©×•×•×ª ×¢×“ 4 ×¡×¤×§×™× ×‘×œ×‘×“');
                checkbox.checked = false;
                return;
            }
            compareItems.push(itemId);
        } else {
            compareItems = compareItems.filter(id => id !== itemId);
        }

        if (compareItems.length >= 2) {
            showCompareButton();
        } else {
            hideCompareButton();
        }
    }

    function showCompareButton() {
        // You can add a floating "Compare Now" button here
        console.log('Compare items:', compareItems);
    }

    function hideCompareButton() {
        console.log('Not enough items to compare');
    }

    // Favorites
    function toggleFavorite(itemId, btn) {
        const index = favorites.indexOf(itemId);
        const heart = btn.querySelector('svg');

        if (index > -1) {
            favorites.splice(index, 1);
            heart.classList.remove('text-red-500');
            heart.classList.add('text-gray-400');
        } else {
            favorites.push(itemId);
            heart.classList.remove('text-gray-400');
            heart.classList.add('text-red-500');
        }

        localStorage.setItem('favorites', JSON.stringify(favorites));
    }

    // View Details
    function viewDetails(id, type) {
        alert(`×¤×¨×˜×™× ×¢×œ ${type} #${id} - ×‘×§×¨×•×‘!`);
        // TODO: Open modal with full details
    }

    // Enhanced Reset Filters
    function resetFilters() {
        document.getElementById('searchInput').value = '';
        document.getElementById('priceRange').value = 20000;
        document.getElementById('sortBy').value = 'recommended';

        selectedCities = [];
        updateCityText();

        minRating = 0;
        document.querySelectorAll('.rating-btn').forEach(btn => {
            btn.classList.remove('bg-[color:var(--color-espresso)]', 'text-white', 'border-[color:var(--color-espresso)]');
        });

        updatePriceDisplay();

        // Reset categories using the main function to sync buttons and checkboxes
        filterByCategory('all');
    }

    // Update Results Counter
    function updateResultsCount() {
        const visibleCards = document.querySelectorAll('.supplier-card:not(.hidden)').length;
        if (document.getElementById('resultsCount')) {
            document.getElementById('resultsCount').textContent = visibleCards;
        }
    }
</script>
{% endblock %}
